{
  "project": {
    "name": "Read Master",
    "description": "AI-powered reading comprehension platform",
    "quality_standard": "Production code. Must be maintainable, testable, and follow best practices. This codebase will outlive you - fight entropy, leave it better than you found it.",
    "completion_criteria": "All PRD items have passes: true, all tests pass, TypeScript has no errors, linting passes, accessibility audit passes WCAG 2.2 AAA"
  },
  "feedback_loops": {
    "required": ["typecheck", "lint", "test"],
    "commands": {
      "typecheck": "pnpm typecheck",
      "lint": "pnpm lint",
      "test": "pnpm vitest run"
    },
    "enforcement": "Do NOT commit if any feedback loop fails. Fix issues first."
  },
  "tasks": [
    {
      "id": "infra-001",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "critical",
      "description": "Create pnpm monorepo structure with workspace configuration",
      "steps": [
        "Create root package.json with workspace configuration",
        "Create pnpm-workspace.yaml defining apps/* and packages/*",
        "Create .npmrc with appropriate settings",
        "Run pnpm install and verify it succeeds",
        "Verify workspace structure is recognized"
      ],
      "acceptance_criteria": [
        "pnpm-workspace.yaml exists and defines workspaces",
        "Root package.json has workspaces configured",
        "pnpm install runs without errors"
      ],
      "passes": true
    },
    {
      "id": "infra-002",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "critical",
      "description": "Set up TypeScript configuration with strict mode for monorepo",
      "steps": [
        "Create root tsconfig.json with strict mode enabled",
        "Create packages/config/tsconfig package for shared TS config",
        "Configure path aliases and module resolution",
        "Verify TypeScript compilation works",
        "Run pnpm typecheck and ensure it passes"
      ],
      "acceptance_criteria": [
        "tsconfig.json exists with strict: true",
        "packages/config exists with shared TS configs",
        "pnpm typecheck passes with no errors"
      ],
      "passes": true
    },
    {
      "id": "infra-003",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "critical",
      "description": "Configure ESLint and Prettier with shared configs",
      "steps": [
        "Create packages/config/eslint package",
        "Create packages/config/prettier package",
        "Set up root eslint.config.js",
        "Set up root prettier.config.js",
        "Run pnpm lint and verify it works",
        "Ensure formatting rules are enforced"
      ],
      "acceptance_criteria": [
        "eslint.config.js exists and is functional",
        "prettier.config.js exists and is functional",
        "pnpm lint runs without errors",
        "pnpm format works"
      ],
      "passes": true
    },
    {
      "id": "infra-004",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "high",
      "description": "Set up Husky pre-commit hooks for lint, typecheck, and format",
      "steps": [
        "Install Husky in root package.json",
        "Configure pre-commit hook to run typecheck",
        "Configure pre-commit hook to run lint",
        "Configure pre-commit hook to run tests",
        "Test that bad commits are rejected",
        "Verify hooks work across all workspaces"
      ],
      "acceptance_criteria": [
        ".husky/pre-commit exists and is executable",
        "Attempting to commit with type errors fails",
        "Attempting to commit with lint errors fails",
        "Attempting to commit with failing tests fails"
      ],
      "passes": true
    },
    {
      "id": "infra-005",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "high",
      "description": "Create apps/web React + Vite + TypeScript app with dependencies",
      "steps": [
        "Initialize apps/web with Vite + React + TypeScript",
        "Add dependencies: react, react-dom, @mui/material, zustand, @tanstack/react-query",
        "Add dev dependencies: vite, @vitejs/plugin-react, vitest",
        "Configure vite.config.ts with path aliases",
        "Create basic App.tsx and main.tsx",
        "Verify pnpm dev starts the app",
        "Verify pnpm build succeeds"
      ],
      "acceptance_criteria": [
        "apps/web/package.json exists with all dependencies",
        "apps/web/vite.config.ts is properly configured",
        "pnpm --filter web dev starts development server",
        "pnpm --filter web build completes successfully"
      ],
      "passes": true
    },
    {
      "id": "infra-006",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "high",
      "description": "Create apps/api Vercel serverless functions structure",
      "steps": [
        "Create apps/api directory structure",
        "Set up package.json with dependencies: zod, winston",
        "Create api/ directory for Vercel functions",
        "Create src/ directory for shared code",
        "Set up TypeScript configuration",
        "Create a test health check endpoint",
        "Verify build works"
      ],
      "acceptance_criteria": [
        "apps/api/package.json exists",
        "apps/api/api/health.ts endpoint exists",
        "TypeScript compiles without errors",
        "Vercel-compatible structure is in place"
      ],
      "passes": true
    },
    {
      "id": "infra-007",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "medium",
      "description": "Set up i18next with initial locale files for 6 languages",
      "steps": [
        "Install i18next, react-i18next dependencies in apps/web",
        "Create apps/web/src/locales directory",
        "Create translation files for: en, ar, es, ja, zh, tl",
        "Configure i18next with language detection",
        "Configure RTL support for Arabic",
        "Add language switcher component",
        "Test language switching works"
      ],
      "acceptance_criteria": [
        "apps/web/src/locales/ contains 6 language files",
        "i18next is configured with RTL support",
        "Language switching works in UI",
        "Arabic displays in RTL mode"
      ],
      "passes": true
    },
    {
      "id": "infra-008",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "medium",
      "description": "Create vercel.json with deployment and cron job configuration",
      "steps": [
        "Create vercel.json in root",
        "Configure API routes rewrites",
        "Add cron jobs: srs-reminders (daily 8am), streak-check (daily midnight), cleanup-expired (weekly)",
        "Configure build settings for both apps",
        "Add environment variable configuration",
        "Verify configuration is valid"
      ],
      "acceptance_criteria": [
        "vercel.json exists with proper structure",
        "Cron jobs are configured correctly",
        "API routes are properly configured",
        "Build commands are set for web and api"
      ],
      "passes": true
    },
    {
      "id": "infra-009",
      "category": "infrastructure",
      "phase": "1-infrastructure",
      "priority": "high",
      "description": "Create comprehensive .env.example with all required variables",
      "steps": [
        "Create .env.example in root",
        "Add Clerk auth variables",
        "Add database variables (Postgres, Redis)",
        "Add AI variables (Anthropic, OpenAI, ElevenLabs)",
        "Add storage variables (Cloudflare R2)",
        "Add external API variables (Google Books)",
        "Add comments explaining each variable",
        "Document where to obtain each API key"
      ],
      "acceptance_criteria": [
        ".env.example exists with all required variables",
        "Each variable has a descriptive comment",
        "File includes instructions for obtaining API keys"
      ],
      "passes": true
    },
    {
      "id": "db-001",
      "category": "database",
      "phase": "2-database",
      "priority": "critical",
      "description": "Set up Prisma in packages/database with initial configuration",
      "steps": [
        "Create packages/database directory",
        "Initialize Prisma with PostgreSQL",
        "Create package.json with Prisma dependencies",
        "Set up prisma/ directory structure",
        "Configure Prisma client generation",
        "Create db.ts for Prisma client singleton",
        "Verify Prisma generates successfully"
      ],
      "acceptance_criteria": [
        "packages/database/package.json exists",
        "packages/database/prisma/schema.prisma exists",
        "Prisma client can be generated",
        "packages/database/src/db.ts exports Prisma client"
      ],
      "passes": true
    },
    {
      "id": "db-002",
      "category": "database",
      "phase": "2-database",
      "priority": "critical",
      "description": "Create User and authentication models in Prisma schema",
      "steps": [
        "Define User model with all fields from spec",
        "Add clerkId as unique identifier",
        "Add preferences as Json field",
        "Add soft delete (deletedAt)",
        "Add proper indexes on clerkId, email, username",
        "Add timestamps (createdAt, updatedAt)",
        "Run prisma format to validate schema"
      ],
      "acceptance_criteria": [
        "User model exists with all specified fields",
        "clerkId has @unique constraint",
        "Indexes are properly defined",
        "prisma format succeeds"
      ],
      "passes": true
    },
    {
      "id": "db-003",
      "category": "database",
      "phase": "2-database",
      "priority": "critical",
      "description": "Create Book, Chapter, and content models in Prisma schema",
      "steps": [
        "Define Book model with all fields from spec",
        "Define Chapter model with ordering",
        "Add BookSource enum (UPLOAD, URL, PASTE, GOOGLE_BOOKS, OPEN_LIBRARY)",
        "Add FileType enum (PDF, EPUB, DOC, DOCX, TXT, HTML)",
        "Add ReadingStatus enum (WANT_TO_READ, READING, COMPLETED, ABANDONED)",
        "Set up relations between User, Book, Chapter",
        "Add indexes on userId, status, tags",
        "Add soft delete support"
      ],
      "acceptance_criteria": [
        "Book model exists with all fields",
        "Chapter model exists with proper ordering",
        "All enums are defined",
        "Relations are properly set up",
        "Indexes are in place"
      ],
      "passes": true
    },
    {
      "id": "db-004",
      "category": "database",
      "phase": "2-database",
      "priority": "critical",
      "description": "Create ReadingProgress and Annotation models",
      "steps": [
        "Define ReadingProgress model with unique constraint on userId+bookId",
        "Add tracking fields: currentPosition, percentage, totalReadTime",
        "Define Annotation model with AnnotationType enum",
        "Add annotation fields: type, offsets, selectedText, note, color",
        "Set up relations to User and Book",
        "Add indexes on frequently queried fields",
        "Add soft delete for annotations"
      ],
      "acceptance_criteria": [
        "ReadingProgress has @@unique([userId, bookId])",
        "Annotation model supports highlights, notes, bookmarks",
        "Relations are properly defined",
        "Indexes are in place"
      ],
      "passes": true
    },
    {
      "id": "db-005",
      "category": "database",
      "phase": "2-database",
      "priority": "high",
      "description": "Create PreReadingGuide and Assessment models",
      "steps": [
        "Define PreReadingGuide model with unique bookId",
        "Add Json fields for vocabulary, keyArguments, chapterSummaries",
        "Add Text fields for context (historical, author, intellectual)",
        "Define Assessment model with AssessmentType enum",
        "Add fields for questions, answers, score, bloomsBreakdown",
        "Set up relations to User and Book",
        "Add proper indexes"
      ],
      "acceptance_criteria": [
        "PreReadingGuide has @unique bookId",
        "All Json fields are properly typed",
        "Assessment model supports different types",
        "Relations work correctly"
      ],
      "passes": true
    },
    {
      "id": "db-006",
      "category": "database",
      "phase": "2-database",
      "priority": "high",
      "description": "Create Flashcard and FlashcardReview models with SRS fields",
      "steps": [
        "Define Flashcard model with SRS fields (easeFactor, interval, repetitions, dueDate)",
        "Add FlashcardType enum (VOCABULARY, CONCEPT, COMPREHENSION, QUOTE, CUSTOM)",
        "Add FlashcardStatus enum (NEW, LEARNING, REVIEW, SUSPENDED)",
        "Define FlashcardReview model for tracking reviews",
        "Add rating field (1-4)",
        "Set up relations to User and Book",
        "Add indexes on dueDate, status",
        "Add soft delete for flashcards"
      ],
      "acceptance_criteria": [
        "Flashcard has all SM-2 algorithm fields",
        "FlashcardReview tracks each review",
        "Enums are properly defined",
        "Indexes support efficient due card queries"
      ],
      "passes": true
    },
    {
      "id": "db-007",
      "category": "database",
      "phase": "2-database",
      "priority": "medium",
      "description": "Create UserStats, Achievement, and UserAchievement models",
      "steps": [
        "Define UserStats model with unique userId",
        "Add gamification fields: totalXP, level, streaks, counters",
        "Define Achievement model with code, criteria",
        "Define UserAchievement junction table",
        "Add unique constraint on userId+achievementId",
        "Set up proper relations",
        "Add indexes for leaderboard queries"
      ],
      "acceptance_criteria": [
        "UserStats has @unique userId",
        "Achievement has @unique code",
        "UserAchievement has @@unique([userId, achievementId])",
        "All gamification fields are present"
      ],
      "passes": true
    },
    {
      "id": "db-008",
      "category": "database",
      "phase": "2-database",
      "priority": "medium",
      "description": "Create Curriculum, CurriculumItem, and CurriculumFollow models",
      "steps": [
        "Define Curriculum model with visibility settings",
        "Add Visibility enum (PRIVATE, UNLISTED, PUBLIC)",
        "Define CurriculumItem model with ordering",
        "Define CurriculumFollow junction table with progress tracking",
        "Add unique constraint on userId+curriculumId",
        "Set up relations between all curriculum models",
        "Add indexes for browsing queries",
        "Add soft delete for curriculums"
      ],
      "acceptance_criteria": [
        "Curriculum supports three visibility levels",
        "CurriculumItem maintains order",
        "CurriculumFollow tracks progress",
        "Relations are properly defined"
      ],
      "passes": true
    },
    {
      "id": "db-009",
      "category": "database",
      "phase": "2-database",
      "priority": "medium",
      "description": "Create social models: Follow, ReadingGroup, GroupMember, GroupDiscussion",
      "steps": [
        "Define Follow model with unique constraint",
        "Define ReadingGroup model",
        "Define ReadingGroupMember with GroupRole enum",
        "Define GroupDiscussion and DiscussionReply models",
        "Add unique constraint on groupId+userId for members",
        "Set up all relations",
        "Add indexes for social queries",
        "Add soft delete where appropriate"
      ],
      "acceptance_criteria": [
        "Follow has @@unique([followerId, followingId])",
        "ReadingGroupMember has @@unique([groupId, userId])",
        "GroupRole enum supports OWNER, ADMIN, MEMBER",
        "Discussion replies support nesting"
      ],
      "passes": true
    },
    {
      "id": "db-010",
      "category": "database",
      "phase": "2-database",
      "priority": "medium",
      "description": "Create forum models: ForumCategory, ForumPost, ForumReply, ForumVote",
      "steps": [
        "Define ForumCategory with unique slug",
        "Define ForumPost with voting fields",
        "Define ForumReply with nested replies support",
        "Define ForumVote with unique constraints",
        "Set up all relations",
        "Add indexes for forum queries",
        "Add soft delete for posts and replies",
        "Add view count tracking"
      ],
      "acceptance_criteria": [
        "ForumCategory has @unique slug",
        "ForumVote has unique constraints for user+post and user+reply",
        "Forum supports nested replies",
        "Voting system is properly modeled"
      ],
      "passes": true
    },
    {
      "id": "db-011",
      "category": "database",
      "phase": "2-database",
      "priority": "high",
      "description": "Create system models: AIUsageLog and AuditLog",
      "steps": [
        "Define AIUsageLog for tracking AI API usage",
        "Add fields for tokens, cost, duration, success",
        "Define AuditLog for change tracking",
        "Add indexes on userId, timestamp, entityType",
        "Use Decimal type for cost tracking",
        "Ensure proper timestamp handling"
      ],
      "acceptance_criteria": [
        "AIUsageLog tracks all AI operations",
        "Cost field uses Decimal(10, 6)",
        "AuditLog has proper indexes",
        "Both models have appropriate fields"
      ],
      "passes": true
    },
    {
      "id": "db-012",
      "category": "database",
      "phase": "2-database",
      "priority": "critical",
      "description": "Create and run initial Prisma migration",
      "steps": [
        "Run prisma migrate dev to create initial migration",
        "Verify migration creates all tables",
        "Check that indexes are created",
        "Verify enums are created",
        "Run prisma generate",
        "Test that Prisma client works",
        "Verify schema.prisma is valid"
      ],
      "acceptance_criteria": [
        "Migration runs successfully",
        "All tables exist in database",
        "Prisma client generates without errors",
        "Can import and use Prisma client"
      ],
      "passes": true
    },
    {
      "id": "db-013",
      "category": "database",
      "phase": "2-database",
      "priority": "medium",
      "description": "Create seed script with sample data",
      "steps": [
        "Create prisma/seed.ts file",
        "Add sample users with different tiers",
        "Add sample books with various statuses",
        "Add sample forum categories",
        "Add all achievement definitions",
        "Configure seed command in package.json",
        "Run seed and verify data is created",
        "Ensure seed is idempotent"
      ],
      "acceptance_criteria": [
        "prisma/seed.ts exists and runs",
        "Sample data covers all major models",
        "Achievement definitions match spec",
        "Can run seed multiple times safely"
      ],
      "passes": true
    },
    {
      "id": "shared-001",
      "category": "shared",
      "phase": "3-shared",
      "priority": "critical",
      "description": "Set up packages/shared structure and export Prisma types",
      "steps": [
        "Create packages/shared directory structure",
        "Set up package.json with dependencies",
        "Create src/types/index.ts",
        "Re-export all Prisma types from @prisma/client",
        "Create additional type definitions for API requests/responses",
        "Set up proper TypeScript configuration",
        "Verify types can be imported in other packages"
      ],
      "acceptance_criteria": [
        "packages/shared/package.json exists",
        "Types are exported from packages/shared",
        "Can import types in apps/web and apps/api",
        "TypeScript compilation works"
      ],
      "passes": true
    },
    {
      "id": "shared-002",
      "category": "shared",
      "phase": "3-shared",
      "priority": "critical",
      "description": "Create Zod schemas for Book operations",
      "steps": [
        "Create src/schemas/books.ts",
        "Define createBookSchema with validation",
        "Define updateBookSchema",
        "Define bookQuerySchema for filtering",
        "Add validation rules (title 1-500 chars, author 1-200 chars)",
        "Export schemas and infer types",
        "Add profanity filter validation to schemas",
        "Write tests for schema validation"
      ],
      "acceptance_criteria": [
        "books.ts exports all book-related schemas",
        "Validation rules match specification",
        "Tests verify schema validation works",
        "Profanity filter is integrated"
      ],
      "passes": true
    },
    {
      "id": "shared-003",
      "category": "shared",
      "phase": "3-shared",
      "priority": "high",
      "description": "Create Zod schemas for Annotations",
      "steps": [
        "Create src/schemas/annotations.ts",
        "Define createAnnotationSchema",
        "Define updateAnnotationSchema",
        "Add validation: note max 5000 chars, color as hex",
        "Export schemas and types",
        "Add profanity filter for notes",
        "Write tests"
      ],
      "acceptance_criteria": [
        "annotations.ts exports all schemas",
        "Validation rules are enforced",
        "Tests pass",
        "Profanity filter works on notes"
      ],
      "passes": true
    },
    {
      "id": "shared-004",
      "category": "shared",
      "phase": "3-shared",
      "priority": "high",
      "description": "Create Zod schemas for Flashcards and SRS",
      "steps": [
        "Create src/schemas/flashcards.ts",
        "Define createFlashcardSchema (front 1-1000, back 1-5000 chars)",
        "Define reviewFlashcardSchema (rating 1-4)",
        "Define updateFlashcardSchema",
        "Export schemas and types",
        "Write tests"
      ],
      "acceptance_criteria": [
        "flashcards.ts exports all schemas",
        "Character limits are enforced",
        "Rating validation works (1-4)",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "shared-005",
      "category": "shared",
      "phase": "3-shared",
      "priority": "high",
      "description": "Create Zod schemas for Forum operations",
      "steps": [
        "Create src/schemas/forum.ts",
        "Define createForumPostSchema (title 3-200, content 10-50000 chars)",
        "Define createForumReplySchema",
        "Define voteSchema",
        "Add profanity filter to all public text fields",
        "Export schemas and types",
        "Write tests"
      ],
      "acceptance_criteria": [
        "forum.ts exports all schemas",
        "Character limits are enforced",
        "Profanity filter is applied",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "shared-006",
      "category": "shared",
      "phase": "3-shared",
      "priority": "high",
      "description": "Create Zod schemas for Assessments, Curriculums, Social features",
      "steps": [
        "Create src/schemas/assessments.ts",
        "Create src/schemas/curriculums.ts with profanity filtering",
        "Create src/schemas/social.ts",
        "Create src/schemas/users.ts",
        "Define all necessary schemas with validation",
        "Apply profanity filtering where appropriate",
        "Export all schemas and types",
        "Write tests"
      ],
      "acceptance_criteria": [
        "All schema files exist",
        "Profanity filtering is applied to public content",
        "Validation rules match spec",
        "Tests pass for all schemas"
      ],
      "passes": true
    },
    {
      "id": "shared-007",
      "category": "shared",
      "phase": "3-shared",
      "priority": "critical",
      "description": "Implement SM-2 spaced repetition algorithm",
      "steps": [
        "Create src/utils/srs.ts",
        "Implement calculateNextReview function",
        "Implement ease factor calculation",
        "Implement interval calculation based on rating",
        "Handle all four ratings (Again, Hard, Good, Easy)",
        "Enforce minimum ease factor of 1.3",
        "Export types and functions",
        "Write comprehensive tests covering all rating scenarios"
      ],
      "acceptance_criteria": [
        "SM-2 algorithm is correctly implemented",
        "All four ratings produce correct intervals",
        "Ease factor minimum is enforced",
        "Tests achieve 100% coverage of algorithm logic"
      ],
      "passes": true
    },
    {
      "id": "shared-008",
      "category": "shared",
      "phase": "3-shared",
      "priority": "critical",
      "description": "Create profanity filter utility",
      "steps": [
        "Create src/utils/moderation.ts",
        "Implement containsProfanity function",
        "Implement validateNoProfanity function",
        "Implement validateFieldsNoProfanity for bulk checking",
        "Implement cleanProfanity function (optional, use cautiously)",
        "Implement getProfaneWords function",
        "Use a robust profanity word list",
        "Write tests covering various profanity scenarios",
        "Test with edge cases and Unicode"
      ],
      "acceptance_criteria": [
        "All profanity utility functions exist",
        "Functions return correct results",
        "Word list covers common profanity",
        "Tests achieve 100% coverage",
        "Edge cases are handled"
      ],
      "passes": true
    },
    {
      "id": "shared-009",
      "category": "shared",
      "phase": "3-shared",
      "priority": "high",
      "description": "Create date and timezone utilities",
      "steps": [
        "Create src/utils/dates.ts",
        "Implement timezone conversion functions",
        "Implement date formatting functions",
        "Implement relative time formatting (2 hours ago)",
        "Handle UTC storage and local display",
        "Export helper functions",
        "Write tests covering different timezones"
      ],
      "acceptance_criteria": [
        "Date utilities handle timezones correctly",
        "Functions work with UTC storage",
        "Relative time formatting works",
        "Tests cover edge cases"
      ],
      "passes": true
    },
    {
      "id": "shared-010",
      "category": "shared",
      "phase": "3-shared",
      "priority": "medium",
      "description": "Create Bloom's Taxonomy utilities",
      "steps": [
        "Create src/utils/blooms.ts",
        "Define Bloom's taxonomy levels (Remember, Understand, Apply, Analyze, Evaluate, Create)",
        "Create helper functions for categorizing questions",
        "Create function to calculate Bloom's breakdown",
        "Export types and functions",
        "Write tests"
      ],
      "acceptance_criteria": [
        "All six Bloom's levels are defined",
        "Helper functions work correctly",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "shared-011",
      "category": "shared",
      "phase": "3-shared",
      "priority": "medium",
      "description": "Create reading level (Lexile) utilities",
      "steps": [
        "Create src/utils/lexile.ts",
        "Implement function to estimate text difficulty",
        "Implement function to recommend reading level",
        "Create helpers for level comparison",
        "Export functions and types",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Lexile utilities exist",
        "Text difficulty estimation works",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "shared-012",
      "category": "shared",
      "phase": "3-shared",
      "priority": "high",
      "description": "Define tier limits and achievement constants",
      "steps": [
        "Create src/constants/limits.ts",
        "Define free tier limits (3 books, 5 AI/day, 50 cards)",
        "Define pro tier limits (unlimited books, 100 AI/day, 5 TTS downloads/month)",
        "Define scholar tier limits (unlimited everything)",
        "Create src/constants/achievements.ts",
        "Define all achievements from spec",
        "Create src/constants/languages.ts",
        "Export all constants"
      ],
      "acceptance_criteria": [
        "All tier limits are defined",
        "All achievements from spec are defined",
        "Language constants exist",
        "Constants can be imported in other packages"
      ],
      "passes": true
    },
    {
      "id": "shared-013",
      "category": "shared",
      "phase": "3-shared",
      "priority": "medium",
      "description": "Create main index.ts with clean exports",
      "steps": [
        "Create src/index.ts",
        "Re-export all types",
        "Re-export all schemas",
        "Re-export all utilities",
        "Re-export all constants",
        "Organize exports by category",
        "Verify imports work cleanly from @read-master/shared"
      ],
      "acceptance_criteria": [
        "index.ts exports everything",
        "Imports work in apps/web and apps/api",
        "No circular dependencies",
        "TypeScript is happy"
      ],
      "passes": true
    },
    {
      "id": "api-infra-001",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "critical",
      "description": "Set up Clerk authentication middleware",
      "steps": [
        "Create src/middleware/auth.ts",
        "Implement Clerk webhook verification",
        "Implement user authentication check",
        "Create helper to extract user from request",
        "Handle authentication errors properly",
        "Export auth middleware",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Auth middleware verifies Clerk tokens",
        "Unauthenticated requests return 401",
        "User info is properly extracted",
        "Tests cover auth scenarios"
      ],
      "passes": true
    },
    {
      "id": "api-infra-002",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "critical",
      "description": "Create error handling middleware",
      "steps": [
        "Create src/middleware/error.ts",
        "Define custom error classes",
        "Implement error handler middleware",
        "Create consistent error response format",
        "Handle Zod validation errors",
        "Handle Prisma errors",
        "Log errors appropriately",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Error middleware handles all error types",
        "Responses have consistent format",
        "Proper HTTP status codes are used",
        "Errors are logged",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-infra-003",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "critical",
      "description": "Create Zod validation middleware",
      "steps": [
        "Create src/middleware/validation.ts",
        "Implement validate function that wraps Zod schemas",
        "Handle validation errors gracefully",
        "Return detailed validation error messages",
        "Support body, query, and params validation",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Validation middleware integrates Zod",
        "Validation errors return 400 with details",
        "Works for body, query, params",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-infra-004",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "high",
      "description": "Implement rate limiting by tier",
      "steps": [
        "Create src/middleware/rateLimit.ts",
        "Integrate with Upstash Redis",
        "Implement tier-based rate limits",
        "Free: 5 AI calls/day, Pro: 100/day, Scholar: unlimited",
        "Track usage per user per operation",
        "Return 429 when limit exceeded",
        "Include rate limit info in headers",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Rate limiting works per tier",
        "Redis stores rate limit data",
        "Limits are enforced correctly",
        "Headers show remaining calls",
        "Tests verify limits"
      ],
      "passes": true
    },
    {
      "id": "api-infra-005",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "high",
      "description": "Set up Winston logging",
      "steps": [
        "Create src/middleware/logger.ts",
        "Configure Winston with appropriate transports",
        "Create structured logging format",
        "Add request logging middleware",
        "Include context: userId, requestId, timestamp",
        "Different log levels for different environments",
        "Write helper functions for logging",
        "Test logging works"
      ],
      "acceptance_criteria": [
        "Winston is configured correctly",
        "Logs include proper context",
        "Log levels work correctly",
        "Request logging captures important info"
      ],
      "passes": true
    },
    {
      "id": "api-infra-006",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "high",
      "description": "Create Prisma database service",
      "steps": [
        "Create src/services/db.ts",
        "Import Prisma client from @read-master/database",
        "Create singleton instance",
        "Add connection handling",
        "Create helper functions for common queries",
        "Ensure proper cleanup on shutdown",
        "Export db instance"
      ],
      "acceptance_criteria": [
        "Database service is a singleton",
        "Connection is properly managed",
        "Can be imported in API routes",
        "No connection leaks"
      ],
      "passes": true
    },
    {
      "id": "api-infra-007",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "high",
      "description": "Create Redis cache service",
      "steps": [
        "Create src/services/redis.ts",
        "Set up Upstash Redis client",
        "Create cache get/set helpers",
        "Implement cache invalidation helpers",
        "Add TTL management",
        "Export cache service",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Redis client connects successfully",
        "Cache operations work",
        "TTL is properly managed",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-infra-008",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "medium",
      "description": "Create response utilities",
      "steps": [
        "Create src/utils/response.ts",
        "Implement success response helper",
        "Implement error response helper",
        "Implement paginated response helper",
        "Ensure consistent response format",
        "Export utilities"
      ],
      "acceptance_criteria": [
        "Response utilities create consistent formats",
        "Success and error responses are standardized",
        "Pagination helper works correctly"
      ],
      "passes": true
    },
    {
      "id": "api-infra-009",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "medium",
      "description": "Create pagination utilities",
      "steps": [
        "Create src/utils/pagination.ts",
        "Implement calculatePagination function",
        "Support limit, offset, page-based pagination",
        "Create helper for Prisma skip/take",
        "Export utilities",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Pagination calculations are correct",
        "Works with Prisma queries",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-infra-010",
      "category": "api-infrastructure",
      "phase": "4a-api-infra",
      "priority": "high",
      "description": "Create health check endpoint",
      "steps": [
        "Create api/health.ts",
        "Check database connection",
        "Check Redis connection",
        "Return status and version info",
        "Return 200 if healthy, 503 if not",
        "Test endpoint works"
      ],
      "acceptance_criteria": [
        "api/health.ts exists",
        "Endpoint checks all services",
        "Returns proper status codes",
        "Works in local and deployed environments"
      ],
      "passes": true
    },
    {
      "id": "api-books-001",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "critical",
      "description": "Create Cloudflare R2 storage service",
      "steps": [
        "Create src/services/storage.ts",
        "Set up R2 client with credentials",
        "Implement uploadFile function",
        "Implement getFile function",
        "Implement deleteFile function",
        "Implement getSignedUrl for downloads",
        "Handle errors properly",
        "Write tests"
      ],
      "acceptance_criteria": [
        "R2 client is properly configured",
        "Upload/download/delete operations work",
        "Signed URLs are generated correctly",
        "Tests verify functionality"
      ],
      "passes": true
    },
    {
      "id": "api-books-002",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "critical",
      "description": "Create book parsing service for EPUB files",
      "steps": [
        "Create src/services/books.ts",
        "Install and configure epub.js for server-side use",
        "Implement parseEPUB function",
        "Extract text content, chapters, metadata",
        "Calculate word count",
        "Extract cover image",
        "Handle parsing errors",
        "Write tests with sample EPUB"
      ],
      "acceptance_criteria": [
        "EPUB files are parsed correctly",
        "Text content is extracted",
        "Chapters are identified",
        "Metadata is extracted",
        "Tests pass with real EPUB"
      ],
      "passes": true
    },
    {
      "id": "api-books-003",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "critical",
      "description": "Create book parsing service for PDF files",
      "steps": [
        "Install pdf-parse package",
        "Implement parsePDF function in src/services/books.ts",
        "Extract text content",
        "Attempt to detect chapters/sections",
        "Calculate word count",
        "Handle parsing errors",
        "Write tests with sample PDF"
      ],
      "acceptance_criteria": [
        "PDF files are parsed correctly",
        "Text content is extracted",
        "Word count is accurate",
        "Tests pass with real PDF"
      ],
      "passes": true
    },
    {
      "id": "api-books-004",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Create book parsing service for DOC/DOCX files",
      "steps": [
        "Install mammoth package",
        "Implement parseDOCX function in src/services/books.ts",
        "Extract text and basic formatting",
        "Calculate word count",
        "Handle parsing errors",
        "Write tests"
      ],
      "acceptance_criteria": [
        "DOCX files are parsed correctly",
        "Text is extracted with formatting info",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-books-005",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "medium",
      "description": "Create Google Books API service",
      "steps": [
        "Create src/services/googleBooks.ts",
        "Implement searchBooks function",
        "Implement getBookDetails function",
        "Parse and normalize API responses",
        "Handle API errors and rate limits",
        "Cache responses in Redis",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Can search Google Books",
        "Can fetch book details",
        "Responses are normalized",
        "Caching works",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-books-006",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "medium",
      "description": "Create Open Library API service",
      "steps": [
        "Create src/services/openLibrary.ts",
        "Implement searchBooks function",
        "Implement getBookDetails function",
        "Implement getBookContent for public domain books",
        "Parse and normalize responses",
        "Handle API errors",
        "Cache responses",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Can search Open Library",
        "Can fetch book details",
        "Can access public domain content",
        "Tests pass"
      ],
      "passes": true
    },
    {
      "id": "api-books-007",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "critical",
      "description": "Implement POST /api/books/upload endpoint",
      "steps": [
        "Create api/books/upload.ts",
        "Accept file upload (multipart/form-data)",
        "Validate file type and size (max 50MB)",
        "Check tier limits (free: 3 books)",
        "Parse file based on type",
        "Upload to R2",
        "Create Book record in database",
        "Return book data",
        "Handle errors",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Endpoint accepts file uploads",
        "File size limit is enforced",
        "Tier limits are checked",
        "Files are parsed correctly",
        "Books are stored in R2 and DB",
        "Tests verify all scenarios"
      ],
      "passes": false
    },
    {
      "id": "api-books-008",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement POST /api/books/import-url endpoint",
      "steps": [
        "Create api/books/import-url.ts",
        "Validate URL format",
        "Fetch content from URL",
        "Extract text (handle HTML, articles)",
        "Check tier limits",
        "Create Book record",
        "Store content for personal use",
        "Return book data",
        "Write tests"
      ],
      "acceptance_criteria": [
        "URL import works",
        "HTML/article extraction works",
        "Tier limits are enforced",
        "Content is stored correctly",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-009",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement POST /api/books/paste endpoint",
      "steps": [
        "Create api/books/paste.ts",
        "Accept text and metadata in body",
        "Validate with Zod schema",
        "Check tier limits",
        "Calculate word count",
        "Create Book record",
        "Return book data",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Can create book from pasted text",
        "Validation works",
        "Tier limits are enforced",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-010",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement GET /api/books/search endpoint",
      "steps": [
        "Create api/books/search.ts",
        "Accept search query",
        "Search Google Books API",
        "Search Open Library API",
        "Combine and deduplicate results",
        "Cache results in Redis",
        "Return normalized results",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Searches both APIs",
        "Results are combined and deduplicated",
        "Caching works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-011",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement POST /api/books/add-from-library endpoint",
      "steps": [
        "Create api/books/add-from-library.ts",
        "Accept book ID and source (Google Books or Open Library)",
        "Fetch book metadata",
        "Fetch content if available (public domain)",
        "Check tier limits",
        "Create Book record",
        "Store content if available",
        "Return book data",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Can add books from external libraries",
        "Metadata is fetched correctly",
        "Public domain content is stored",
        "Tier limits are enforced",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-012",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "critical",
      "description": "Implement GET /api/books endpoint with filtering and pagination",
      "steps": [
        "Create api/books/index.ts for GET",
        "Accept query params: status, tags, genre, search, sort, page, limit",
        "Build Prisma query with filters",
        "Apply soft delete filter",
        "Implement sorting options",
        "Use pagination utilities",
        "Return paginated results",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Listing works with all filters",
        "Pagination works correctly",
        "Soft deletes are excluded",
        "Sorting works",
        "Tests verify all scenarios"
      ],
      "passes": false
    },
    {
      "id": "api-books-013",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement GET /api/books/:id endpoint",
      "steps": [
        "Create api/books/[id].ts for GET",
        "Fetch book with chapters",
        "Include reading progress for current user",
        "Check user has access to book",
        "Return 404 if not found or no access",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Book details are returned with chapters",
        "Reading progress is included",
        "Access control works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-014",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement PUT /api/books/:id endpoint",
      "steps": [
        "Create api/books/[id].ts for PUT",
        "Validate update data with Zod",
        "Check user owns the book",
        "Update book metadata",
        "Handle status changes",
        "Log audit trail",
        "Return updated book",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Book updates work",
        "Validation is enforced",
        "Only owner can update",
        "Audit log is created",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-015",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement DELETE /api/books/:id endpoint",
      "steps": [
        "Create api/books/[id].ts for DELETE",
        "Check user owns the book",
        "Soft delete book (set deletedAt)",
        "Soft delete related annotations, flashcards",
        "Log audit trail",
        "Return success response",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Soft delete works",
        "Related data is soft deleted",
        "Only owner can delete",
        "Audit log is created",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-books-016",
      "category": "api-books",
      "phase": "4b-books-api",
      "priority": "medium",
      "description": "Implement GET /api/books/:id/content endpoint",
      "steps": [
        "Create api/books/[id]/content.ts",
        "Check user has access to book",
        "Fetch content from R2 or database",
        "Support range requests for large files",
        "Stream content to client",
        "Set appropriate headers",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Content is streamed correctly",
        "Range requests work",
        "Access control is enforced",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-reading-001",
      "category": "api-reading",
      "phase": "4b-books-api",
      "priority": "critical",
      "description": "Implement reading progress tracking endpoints",
      "steps": [
        "Create api/reading/progress.ts for GET and PUT",
        "GET: Fetch reading progress for a book",
        "PUT: Update reading position, calculate percentage",
        "Track total read time",
        "Update lastReadAt timestamp",
        "Handle completion (set completedAt)",
        "Award XP on completion",
        "Check for achievements",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Progress tracking works",
        "Percentage is calculated correctly",
        "Completion is detected",
        "XP and achievements are awarded",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-annotations-001",
      "category": "api-annotations",
      "phase": "4b-books-api",
      "priority": "high",
      "description": "Implement annotation CRUD endpoints",
      "steps": [
        "Create api/annotations/index.ts",
        "POST: Create annotation (highlight, note, bookmark)",
        "GET: List annotations for a book with filters",
        "PUT: Update annotation",
        "DELETE: Soft delete annotation",
        "Validate with Zod schemas",
        "Apply profanity filter to notes",
        "Support public/private annotations",
        "Write tests"
      ],
      "acceptance_criteria": [
        "All annotation types work",
        "CRUD operations function correctly",
        "Profanity filter is applied",
        "Privacy settings work",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-001",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "critical",
      "description": "Set up Vercel AI SDK with Anthropic Claude",
      "steps": [
        "Create src/services/ai.ts",
        "Configure Vercel AI SDK",
        "Set up Anthropic provider",
        "Create streamCompletion helper",
        "Implement token counting",
        "Implement cost calculation",
        "Create logging wrapper for AI calls",
        "Test streaming works"
      ],
      "acceptance_criteria": [
        "AI SDK is configured correctly",
        "Streaming works",
        "Token usage is tracked",
        "Costs are calculated",
        "All calls are logged"
      ],
      "passes": false
    },
    {
      "id": "api-ai-002",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "critical",
      "description": "Create AI prompt templates package",
      "steps": [
        "Create packages/ai/src/prompts/v1/ directory",
        "Create preReadingGuide.ts prompt template",
        "Create explain.ts prompt template",
        "Create comprehensionCheck.ts prompt template",
        "Create assessment.ts prompt template",
        "Create gradeAnswer.ts prompt template",
        "Create generateFlashcards.ts prompt template",
        "Export all prompts",
        "Include user reading level in prompts"
      ],
      "acceptance_criteria": [
        "All prompt templates exist",
        "Prompts adapt to user level",
        "Prompts can be imported in API",
        "Templates are well-structured"
      ],
      "passes": false
    },
    {
      "id": "api-ai-003",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "critical",
      "description": "Implement POST /api/ai/pre-reading-guide endpoint",
      "steps": [
        "Create api/ai/pre-reading-guide.ts",
        "Check user has AI enabled",
        "Check rate limits",
        "Fetch book content",
        "Use pre-reading guide prompt",
        "Stream AI response",
        "Parse response into structured data",
        "Save to PreReadingGuide table",
        "Log usage and cost",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Guide generates correctly",
        "Streaming works",
        "Data is saved to database",
        "Usage is logged",
        "Rate limits are enforced",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-004",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "high",
      "description": "Implement POST /api/ai/explain endpoint",
      "steps": [
        "Create api/ai/explain.ts",
        "Accept selected text and book context",
        "Check rate limits and AI enabled",
        "Use explain prompt with context",
        "Stream response",
        "Log usage",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Explanations are contextual",
        "Streaming works",
        "Rate limits enforced",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-005",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "high",
      "description": "Implement POST /api/ai/ask endpoint",
      "steps": [
        "Create api/ai/ask.ts",
        "Accept question and selected text",
        "Include book context",
        "Check rate limits",
        "Stream AI response",
        "Log usage",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Questions are answered correctly",
        "Context is maintained",
        "Streaming works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-006",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "high",
      "description": "Implement POST /api/ai/comprehension-check endpoint",
      "steps": [
        "Create api/ai/comprehension-check.ts",
        "Accept recently read content",
        "Generate quick question",
        "Return question with options",
        "Track question in database",
        "Log usage",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Questions are relevant",
        "Format is correct",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-007",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "high",
      "description": "Implement POST /api/ai/assessment endpoint",
      "steps": [
        "Create api/ai/assessment.ts",
        "Accept book ID and assessment type",
        "Generate questions covering all Bloom's levels",
        "Adapt difficulty to user level",
        "Return structured assessment",
        "Save to Assessment table",
        "Log usage",
        "Write tests"
      ],
      "acceptance_criteria": [
        "All Bloom's levels are covered",
        "Difficulty adapts to user",
        "Questions are high quality",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-008",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "high",
      "description": "Implement POST /api/ai/grade-answer endpoint",
      "steps": [
        "Create api/ai/grade-answer.ts",
        "Accept question, correct answer, user answer",
        "Use AI to grade short answer",
        "Provide detailed feedback",
        "Calculate score",
        "Update assessment record",
        "Update user comprehension data",
        "Log usage",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Grading is fair and consistent",
        "Feedback is helpful",
        "Scores are accurate",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-ai-009",
      "category": "api-ai",
      "phase": "4c-ai-api",
      "priority": "high",
      "description": "Implement POST /api/ai/generate-flashcards endpoint",
      "steps": [
        "Create api/ai/generate-flashcards.ts",
        "Accept text and card type preferences",
        "Generate flashcards for vocabulary, concepts, comprehension",
        "Check for duplicates",
        "Create Flashcard records",
        "Return generated cards",
        "Log usage",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Cards are high quality",
        "Duplicates are avoided",
        "Multiple card types work",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-srs-001",
      "category": "api-srs",
      "phase": "4d-srs-api",
      "priority": "critical",
      "description": "Implement flashcard CRUD endpoints",
      "steps": [
        "Create api/flashcards/index.ts",
        "GET: List user's flashcards with filters",
        "POST: Create manual flashcard",
        "PUT: Update flashcard",
        "DELETE: Soft delete (suspend)",
        "Support filtering by book, status, tags",
        "Implement pagination",
        "Write tests"
      ],
      "acceptance_criteria": [
        "CRUD operations work",
        "Filtering works correctly",
        "Pagination works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-srs-002",
      "category": "api-srs",
      "phase": "4d-srs-api",
      "priority": "critical",
      "description": "Implement GET /api/flashcards/due endpoint",
      "steps": [
        "Create api/flashcards/due.ts",
        "Fetch cards where dueDate <= now",
        "Order by priority (overdue first, then by dueDate)",
        "Respect user's daily limit setting",
        "Return cards with context",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Due cards are returned correctly",
        "Ordering is correct",
        "Daily limit is respected",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-srs-003",
      "category": "api-srs",
      "phase": "4d-srs-api",
      "priority": "critical",
      "description": "Implement POST /api/flashcards/:id/review endpoint with SM-2 algorithm",
      "steps": [
        "Create api/flashcards/[id]/review.ts",
        "Accept rating (1-4)",
        "Calculate new interval using SM-2 from shared package",
        "Update easeFactor, interval, repetitions, dueDate",
        "Update status (NEW -> LEARNING -> REVIEW)",
        "Create FlashcardReview record",
        "Award XP based on rating",
        "Check for achievements",
        "Update UserStats",
        "Write tests with all rating scenarios"
      ],
      "acceptance_criteria": [
        "SM-2 calculations are correct for all ratings",
        "Card state updates properly",
        "XP is awarded",
        "Review is logged",
        "Tests cover all scenarios"
      ],
      "passes": false
    },
    {
      "id": "api-srs-004",
      "category": "api-srs",
      "phase": "4d-srs-api",
      "priority": "medium",
      "description": "Implement GET /api/flashcards/stats endpoint",
      "steps": [
        "Create api/flashcards/stats.ts",
        "Calculate retention rate",
        "Count cards by status",
        "Get review history",
        "Calculate streak",
        "Return statistics",
        "Write tests"
      ],
      "acceptance_criteria": [
        "All statistics are accurate",
        "Retention rate is calculated correctly",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-gamification-001",
      "category": "api-gamification",
      "phase": "4d-srs-api",
      "priority": "high",
      "description": "Implement GET /api/stats endpoint",
      "steps": [
        "Create api/stats/index.ts",
        "Fetch user's UserStats",
        "Calculate current level from XP",
        "Include progress to next level",
        "Return all gamification stats",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Stats are returned correctly",
        "Level calculation works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-gamification-002",
      "category": "api-gamification",
      "phase": "4d-srs-api",
      "priority": "high",
      "description": "Implement achievements system endpoints",
      "steps": [
        "Create api/achievements/index.ts",
        "GET: List all achievements with user's unlock status",
        "POST /check: Check and award new achievements",
        "Implement achievement criteria checking",
        "Award XP when unlocking",
        "Create UserAchievement records",
        "Return newly unlocked achievements",
        "Write tests for all achievement types"
      ],
      "acceptance_criteria": [
        "All achievements are checkable",
        "Unlocking works correctly",
        "XP is awarded",
        "Tests verify all achievement types"
      ],
      "passes": false
    },
    {
      "id": "api-gamification-003",
      "category": "api-gamification",
      "phase": "4d-srs-api",
      "priority": "medium",
      "description": "Implement GET /api/leaderboard endpoint",
      "steps": [
        "Create api/leaderboard/index.ts",
        "Support global and friends leaderboards",
        "Filter by timeframe (weekly, monthly, all-time)",
        "Sort by metric (XP, books, streak)",
        "Only include users who opted in",
        "Highlight current user",
        "Implement pagination",
        "Cache results",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Leaderboard filtering works",
        "Privacy is respected (opt-in only)",
        "Current user is highlighted",
        "Caching works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-tts-001",
      "category": "api-tts",
      "phase": "4e-tts-api",
      "priority": "high",
      "description": "Implement POST /api/tts/speak endpoint with tier-based providers",
      "steps": [
        "Create api/tts/speak.ts",
        "Check user's subscription tier",
        "Free: Return config for Web Speech API (client-side)",
        "Pro: Use OpenAI TTS API and stream audio",
        "Scholar: Use ElevenLabs API and stream audio",
        "Track usage",
        "Handle errors",
        "Write tests for all tiers"
      ],
      "acceptance_criteria": [
        "Free tier returns browser config",
        "Pro tier streams OpenAI audio",
        "Scholar tier streams ElevenLabs audio",
        "Usage is tracked",
        "Tests cover all tiers"
      ],
      "passes": false
    },
    {
      "id": "api-tts-002",
      "category": "api-tts",
      "phase": "4e-tts-api",
      "priority": "medium",
      "description": "Create TTS service for OpenAI and ElevenLabs",
      "steps": [
        "Create src/services/tts.ts",
        "Implement OpenAI TTS integration",
        "Implement ElevenLabs integration",
        "Handle text chunking for long content",
        "Stream audio responses",
        "Handle rate limits",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Both providers work correctly",
        "Long text is chunked properly",
        "Streaming works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-tts-003",
      "category": "api-tts",
      "phase": "4e-tts-api",
      "priority": "medium",
      "description": "Implement GET /api/tts/voices endpoint",
      "steps": [
        "Create api/tts/voices.ts",
        "Return available voices based on tier",
        "Free: Browser default voices",
        "Pro: OpenAI voices (alloy, echo, fable, onyx, nova, shimmer)",
        "Scholar: ElevenLabs premium voices",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Voices are returned per tier",
        "All voice options are available",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-tts-004",
      "category": "api-tts",
      "phase": "4e-tts-api",
      "priority": "medium",
      "description": "Implement full book audio download endpoints",
      "steps": [
        "Create api/tts/download.ts for POST",
        "Check download quota (Pro: 5/month, Scholar: unlimited)",
        "Create background job for generation",
        "Generate audio in chunks",
        "Combine chunks into final file",
        "Upload to R2",
        "Track download in database",
        "Return job ID",
        "Create api/tts/downloads.ts for GET (list downloads)",
        "Create api/tts/downloads/[id].ts for DELETE",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Download limits are enforced",
        "Audio generation works",
        "Files are stored in R2",
        "Status tracking works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-social-001",
      "category": "api-social",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement user profile endpoints",
      "steps": [
        "Create api/users/[username].ts",
        "GET: Fetch public profile",
        "Check privacy settings",
        "Return stats if shared",
        "Return reading activity if shared",
        "Return achievements",
        "Hide private info",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Public profiles work",
        "Privacy settings are respected",
        "Private data is hidden",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-social-002",
      "category": "api-social",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement follow/unfollow endpoints",
      "steps": [
        "Create api/users/[id]/follow.ts",
        "POST: Create follow relationship",
        "DELETE: Remove follow relationship",
        "Prevent duplicate follows",
        "Update follower counts",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Following works",
        "Unfollowing works",
        "No duplicates allowed",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-social-003",
      "category": "api-social",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement followers/following list endpoints",
      "steps": [
        "Create api/users/[id]/followers.ts",
        "Create api/users/[id]/following.ts",
        "Implement pagination",
        "Support search",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Lists work correctly",
        "Pagination works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-social-004",
      "category": "api-social",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement activity feed endpoint",
      "steps": [
        "Create api/feed.ts",
        "Fetch activity from followed users",
        "Include: reading completions, achievements, shared highlights",
        "Respect privacy settings",
        "Implement pagination",
        "Cache results",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Feed shows relevant activity",
        "Privacy is respected",
        "Pagination works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-groups-001",
      "category": "api-groups",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement reading groups CRUD endpoints",
      "steps": [
        "Create api/groups/index.ts",
        "POST: Create group (Pro/Scholar only)",
        "GET: List groups (public + user's private)",
        "Support search and filters",
        "Implement pagination",
        "Create api/groups/[id].ts for GET, PUT, DELETE",
        "Apply profanity filter to names/descriptions",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Group creation is tier-locked",
        "CRUD operations work",
        "Profanity filter is applied",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-groups-002",
      "category": "api-groups",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement group membership endpoints",
      "steps": [
        "Create api/groups/[id]/join.ts",
        "POST: Join group or accept invite",
        "Check if public or has invite",
        "Create membership record",
        "Create api/groups/[id]/leave.ts",
        "DELETE: Leave group (unless owner)",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Joining works",
        "Leaving works",
        "Owner cannot leave",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-groups-003",
      "category": "api-groups",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement group discussions endpoints",
      "steps": [
        "Create api/groups/[id]/discussions.ts",
        "POST: Create discussion thread",
        "GET: List discussions",
        "Apply profanity filter",
        "Create api/discussions/[id]/replies.ts",
        "POST: Reply to discussion",
        "Support nested replies",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Discussions work",
        "Replies work with nesting",
        "Profanity filter is applied",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-forum-001",
      "category": "api-forum",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement forum category and post listing endpoints",
      "steps": [
        "Create api/forum/categories.ts for GET",
        "Create api/forum/posts.ts for GET",
        "Support filtering by category",
        "Support sorting (recent, popular, unanswered)",
        "Implement pagination",
        "Cache results",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Categories list correctly",
        "Posts list with filters",
        "Sorting works",
        "Pagination works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-forum-002",
      "category": "api-forum",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement forum post CRUD endpoints",
      "steps": [
        "Create api/forum/posts.ts for POST",
        "Validate with Zod schema",
        "Apply profanity filter",
        "Create post record",
        "Create api/forum/posts/[id].ts for GET, PUT, DELETE",
        "Include replies in GET",
        "Increment view count",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Post creation works",
        "Profanity filter is applied",
        "CRUD operations work",
        "View counting works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-forum-003",
      "category": "api-forum",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement forum reply and voting endpoints",
      "steps": [
        "Create api/forum/posts/[id]/replies.ts for POST",
        "Support nested replies (parentReplyId)",
        "Apply profanity filter",
        "Create api/forum/posts/[id]/vote.ts",
        "Create api/forum/replies/[id]/vote.ts",
        "Handle upvote/downvote",
        "Prevent duplicate votes",
        "Update vote counts",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Replies work with nesting",
        "Voting works for posts and replies",
        "No duplicate votes",
        "Counts update correctly",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-forum-004",
      "category": "api-forum",
      "phase": "4f-social-api",
      "priority": "medium",
      "description": "Implement forum moderation endpoints",
      "steps": [
        "Create api/forum/replies/[id]/best-answer.ts",
        "Allow OP to mark best answer",
        "Create api/forum/report.ts",
        "Handle content reports",
        "Queue for moderator review",
        "Create moderator endpoints for review",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Best answer marking works",
        "Reporting works",
        "Moderation queue works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-curriculum-001",
      "category": "api-curriculums",
      "phase": "4g-curriculum-api",
      "priority": "medium",
      "description": "Implement curriculum CRUD endpoints",
      "steps": [
        "Create api/curriculums/index.ts",
        "POST: Create curriculum (Pro/Scholar only)",
        "GET: List user's curriculums",
        "Apply profanity filter to title/description",
        "Create api/curriculums/[id].ts for GET, PUT, DELETE",
        "Include items in GET",
        "Include follow status",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Creation is tier-locked",
        "CRUD operations work",
        "Profanity filter is applied",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-curriculum-002",
      "category": "api-curriculums",
      "phase": "4g-curriculum-api",
      "priority": "medium",
      "description": "Implement curriculum browse and search endpoints",
      "steps": [
        "Create api/curriculums/browse.ts",
        "Support filtering by category, difficulty",
        "Support sorting (popularity, recent, rating)",
        "Implement search",
        "Implement pagination",
        "Only show public curriculums",
        "Cache results",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Browsing works with filters",
        "Search works",
        "Sorting works",
        "Only public curriculums shown",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-curriculum-003",
      "category": "api-curriculums",
      "phase": "4g-curriculum-api",
      "priority": "medium",
      "description": "Implement curriculum items endpoints",
      "steps": [
        "Create api/curriculums/[id]/items.ts",
        "POST: Add item to curriculum",
        "Support reordering items",
        "Create api/curriculums/[id]/items/[itemId].ts",
        "PUT: Update item",
        "DELETE: Remove item",
        "Maintain order integrity",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Items can be added",
        "Reordering works",
        "CRUD operations work",
        "Order is maintained",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-curriculum-004",
      "category": "api-curriculums",
      "phase": "4g-curriculum-api",
      "priority": "medium",
      "description": "Implement curriculum follow/progress endpoints",
      "steps": [
        "Create api/curriculums/[id]/follow.ts",
        "POST: Follow curriculum",
        "DELETE: Unfollow",
        "Create api/curriculums/[id]/progress.ts",
        "PUT: Update progress through curriculum",
        "Track currentItemIndex",
        "Write tests"
      ],
      "acceptance_criteria": [
        "Following works",
        "Progress tracking works",
        "Tests pass"
      ],
      "passes": false
    },
    {
      "id": "api-cron-001",
      "category": "api-cron",
      "phase": "4g-curriculum-api",
      "priority": "low",
      "description": "Implement cron job endpoints",
      "steps": [
        "Create api/cron/srs-reminders.ts",
        "Send email reminders for due flashcards",
        "Create api/cron/streak-check.ts",
        "Check and update streaks daily",
        "Award streak achievements",
        "Create api/cron/cleanup-expired.ts",
        "Clean up expired downloads",
        "Clean up old audit logs",
        "Verify cron jobs are configured in vercel.json",
        "Write tests"
      ],
      "acceptance_criteria": [
        "All cron jobs are implemented",
        "Jobs run on schedule",
        "Tests verify job logic"
      ],
      "passes": false
    }
  ]
}
